(self.webpackChunkblog_vuepress=self.webpackChunkblog_vuepress||[]).push([[70],{5680:(n,s,a)=>{"use strict";a.r(s),a.d(s,{data:()=>e});const e={key:"v-487e7bb9",path:"/advanced/cookbook/usage-of-client-app-enhance.html",title:"Client App Enhance 的使用方法",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"注册 Vue 组件",slug:"注册-vue-组件",children:[]},{level:2,title:"使用不支持 SSR 的功能",slug:"使用不支持-ssr-的功能",children:[]},{level:2,title:"使用 Router 方法",slug:"使用-router-方法",children:[]}],filePathRelative:"advanced/cookbook/usage-of-client-app-enhance.md",git:{updatedTime:1621846301e3}}},5435:(n,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>tn});var e=a(6252);const p=(0,e.Wm)("h1",{id:"client-app-enhance-的使用方法"},[(0,e.Wm)("a",{class:"header-anchor",href:"#client-app-enhance-的使用方法"},"#"),(0,e.Uk)(" Client App Enhance 的使用方法")],-1),t=(0,e.Uk)("插件 API 提供的 "),o=(0,e.Uk)("clientAppEnhanceFiles"),c=(0,e.Uk)(" Hook 允许你设置 Client App Enhance 文件的路径。你可以在你的插件或者主题中使用它："),l=(0,e.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> path <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/utils&#39;</span>\n\n<span class="token keyword">const</span> pluginOrTheme <span class="token operator">=</span> <span class="token punctuation">{</span>\n  clientAppEnhanceFiles<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./path/to/clientAppEnhance.ts&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),u=(0,e.Uk)("然后，创建 "),r=(0,e.Wm)("code",null,"clientAppEnhance.ts",-1),i=(0,e.Uk)(" 文件。你可以使用 "),k=(0,e.Uk)("defineClientAppEnhance"),m=(0,e.Uk)(" Helper 来获取类型提示。注意这个函数既可以是同步的，也可以是异步的。"),d=(0,e.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineClientAppEnhance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/client&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineClientAppEnhance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> siteData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>',1),b=(0,e.Wm)("code",null,"app",-1),h=(0,e.Uk)(" 是由 "),f={href:"https://v3.cn.vuejs.org/api/application-api.html",target:"_blank",rel:"noopener noreferrer"},g=(0,e.Uk)("createApp"),v=(0,e.Uk)(" 创建的 Vue 应用实例。"),y=(0,e.Wm)("code",null,"router",-1),W=(0,e.Uk)(" 是由 "),U={href:"https://next.router.vuejs.org/zh/api/index.html#createrouter",target:"_blank",rel:"noopener noreferrer"},w=(0,e.Uk)("createRouter"),E=(0,e.Uk)(" 创建的路由实例。"),_=(0,e.Wm)("code",null,"siteData",-1),A=(0,e.Uk)(" 是一个根据用户配置生成的对象，包含 "),C=(0,e.Uk)("base"),S=(0,e.Uk)(", "),R=(0,e.Uk)("lang"),x=(0,e.Uk)(", "),M=(0,e.Uk)("title"),j=(0,e.Uk)(", "),D=(0,e.Uk)("description"),V=(0,e.Uk)(", "),P=(0,e.Uk)("head"),F=(0,e.Uk)(" 和 "),I=(0,e.Uk)("locales"),O=(0,e.Uk)("。"),z=(0,e.Wm)("p",null,"Client App Enhance 会在客户端应用创建后被调用，它可以为 Vue 应用添加任意功能。",-1),H=(0,e.Wm)("div",{class:"custom-container tip"},[(0,e.Wm)("p",{class:"custom-container-title"},"TIP"),(0,e.Wm)("p",null,[(0,e.Uk)("为了方便用户配置使用， "),(0,e.Wm)("code",null,".vuepress/clientAppEnhance.{js,ts}"),(0,e.Uk)(" 文件会被隐式地用作 Client App Enhance 文件，除非你在配置文件中显式设置了 "),(0,e.Wm)("code",null,"clientAppEnhanceFiles"),(0,e.Uk)(" 。")])],-1),N=(0,e.Wm)("h2",{id:"注册-vue-组件"},[(0,e.Wm)("a",{class:"header-anchor",href:"#注册-vue-组件"},"#"),(0,e.Uk)(" 注册 Vue 组件")],-1),T=(0,e.Uk)("你可以通过 "),B={href:"https://v3.cn.vuejs.org/api/application-api.html#component",target:"_blank",rel:"noopener noreferrer"},L=(0,e.Uk)("component"),G=(0,e.Uk)(" 方法来注册 Vue 全局组件："),Y=(0,e.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineClientAppEnhance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/client&#39;</span>\n<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">&#39;./MyComponent.vue&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineClientAppEnhance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> siteData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  app<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;MyComponent&#39;</span><span class="token punctuation">,</span> MyComponent<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="使用不支持-ssr-的功能"><a class="header-anchor" href="#使用不支持-ssr-的功能">#</a> 使用不支持 SSR 的功能</h2><p>VuePress 会在构建过程中生成一个 SSR 应用，用以对页面进行预渲染。一般而言，如果一段代码在客户端应用 Mount 之前就使用了浏览器或 DOM API ，我们就认为其对 SSR 不友好，即不支持 SSR 。</p>',3),q=(0,e.Uk)("我们已经提供了一个 "),J=(0,e.Uk)("ClientOnly"),K=(0,e.Uk)(" 组件来包裹不支持 SSR 的内容。"),Q=(0,e.Uk)("在 Client App Enhance 文件中，你可以使用 "),X=(0,e.Wm)("code",null,"__SSR__",-1),Z=(0,e.Uk)(" 标记来处理这种情况。"),$=(0,e.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineClientAppEnhance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/client&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineClientAppEnhance</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> siteData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__SSR__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> nonSsrFriendlyModule <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;non-ssr-friendly-module&#39;</span><span class="token punctuation">)</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="使用-router-方法"><a class="header-anchor" href="#使用-router-方法">#</a> 使用 Router 方法</h2>',2),nn=(0,e.Uk)("你可以使用 vue-router 提供的 "),sn={href:"https://next.router.vuejs.org/zh/api/index.html#router-%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},an=(0,e.Uk)("Router 方法"),en=(0,e.Uk)(" 。例如，添加导航钩子："),pn=(0,e.uE)('<div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineClientAppEnhance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vuepress/client&#39;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineClientAppEnhance</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> app<span class="token punctuation">,</span> router<span class="token punctuation">,</span> siteData <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;before navigation&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  router<span class="token punctuation">.</span><span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;after navigation&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>我们不推荐使用 <code>addRoute</code> 方法来添加动态路由，因为这些路由记录 <strong>不会</strong> 在构建模式中被预渲染出来。</p><p>当然，如果你了解了这种用法的缺点，你还是可以这样使用。</p></div>',2),tn={render:function(n,s){const a=(0,e.up)("RouterLink"),tn=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.j4)(e.HY,null,[p,(0,e.Wm)("p",null,[t,(0,e.Wm)(a,{to:"/reference/plugin-api.html#clientappenhancefiles"},{default:(0,e.w5)((()=>[o])),_:1}),c]),l,(0,e.Wm)("p",null,[u,r,i,(0,e.Wm)(a,{to:"/reference/client-api.html#defineclientappenhance"},{default:(0,e.w5)((()=>[k])),_:1}),m]),d,(0,e.Wm)("ul",null,[(0,e.Wm)("li",null,[b,h,(0,e.Wm)("a",f,[g,(0,e.Wm)(tn)]),v]),(0,e.Wm)("li",null,[y,W,(0,e.Wm)("a",U,[w,(0,e.Wm)(tn)]),E]),(0,e.Wm)("li",null,[_,A,(0,e.Wm)(a,{to:"/reference/config.html#base"},{default:(0,e.w5)((()=>[C])),_:1}),S,(0,e.Wm)(a,{to:"/reference/config.html#lang"},{default:(0,e.w5)((()=>[R])),_:1}),x,(0,e.Wm)(a,{to:"/reference/config.html#title"},{default:(0,e.w5)((()=>[M])),_:1}),j,(0,e.Wm)(a,{to:"/reference/config.html#description"},{default:(0,e.w5)((()=>[D])),_:1}),V,(0,e.Wm)(a,{to:"/reference/config.html#head"},{default:(0,e.w5)((()=>[P])),_:1}),F,(0,e.Wm)(a,{to:"/reference/config.html#locales"},{default:(0,e.w5)((()=>[I])),_:1}),O])]),z,H,N,(0,e.Wm)("p",null,[T,(0,e.Wm)("a",B,[L,(0,e.Wm)(tn)]),G]),Y,(0,e.Wm)("p",null,[q,(0,e.Wm)(a,{to:"/reference/components.html#clientonly"},{default:(0,e.w5)((()=>[J])),_:1}),K]),(0,e.Wm)("p",null,[Q,(0,e.Wm)(a,{to:"/reference/client-api.html#ssr"},{default:(0,e.w5)((()=>[X])),_:1}),Z]),$,(0,e.Wm)("p",null,[nn,(0,e.Wm)("a",sn,[an,(0,e.Wm)(tn)]),en]),pn],64)}}}}]);